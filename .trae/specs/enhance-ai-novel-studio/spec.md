# AI Novel Studio 功能增强规格

## Why

AI Novel Studio 当前存在一些关键功能缺陷（项目删除、章节删除不工作）以及缺失多个 AI 辅助生成功能。本规格旨在修复这些问题并扩展 AI 辅助创作能力，使平台更加完善和实用。

## What Changes

### Bug 修复
- **修复项目删除功能** - 前端 API 参数名与后端不匹配
- **修复章节删除功能** - 检查并修复前后端参数传递

### 新增 AI 生成功能
- **AI 生成角色** - 根据项目背景和现有角色自动生成新角色
- **AI 生成角色关系** - 智能生成角色之间的关系网络
- **AI 生成世界观** - 根据项目类型和已有内容生成世界观设定
- **AI 生成情节点** - 根据剧情走向自动生成情节点建议

### 内容生成扩展
- **分镜提示词生成** - 根据剧情内容生成分镜脚本提示词
- **多媒体内容规划** - 生成插画、漫画、视频等内容规划

### 系统完善
- **系统设置增强** - 完善 AI 模型配置、API 密钥管理等
- **文章排版系统** - 支持 AI 一键排版、对话加粗等格式化功能
- **阅读系统** - 提供舒适的阅读体验

## Impact

- **受影响的规格**: AI 服务、项目管理、角色管理、世界观管理、情节点管理
- **受影响的代码**:
  - 前端: `src/services/api.ts`, `src/components/*`, `src/App.tsx`
  - 后端: `src-tauri/src/commands.rs`, `src-tauri/src/ai/service.rs`

---

## ADDED Requirements

### Requirement: Bug 修复 - 项目删除

系统应正确执行项目删除操作，确保前端参数与后端接口匹配。

#### Scenario: 成功删除项目
- **GIVEN** 用户在项目列表中选择一个项目
- **WHEN** 用户点击删除按钮并确认
- **THEN** 项目应从数据库中删除，项目列表应更新

### Requirement: Bug 修复 - 章节删除

系统应正确执行章节删除操作。

#### Scenario: 成功删除章节
- **GIVEN** 用户选择一个章节
- **WHEN** 用户点击删除按钮并确认
- **THEN** 章节应从数据库中删除，章节列表应更新

### Requirement: AI 生成角色

系统应提供 AI 辅助角色生成功能，根据项目背景和现有内容创建新角色。

#### Scenario: 成功生成角色
- **GIVEN** 用户在一个项目中
- **WHEN** 用户点击"AI 生成角色"按钮并提供角色类型或描述
- **THEN** 系统应调用 AI 生成完整的角色信息（姓名、年龄、性别、外貌、性格、背景）
- **AND** 生成的角色应显示预览供用户确认或修改

### Requirement: AI 生成角色关系

系统应提供 AI 辅助角色关系生成功能。

#### Scenario: 成功生成角色关系
- **GIVEN** 项目中已有多个角色
- **WHEN** 用户点击"AI 生成关系"按钮
- **THEN** 系统应分析角色特征并建议合适的关系网络
- **AND** 用户可以接受、修改或拒绝建议的关系

### Requirement: AI 生成世界观

系统应提供 AI 辅助世界观生成功能。

#### Scenario: 成功生成世界观
- **GIVEN** 用户在一个项目中
- **WHEN** 用户点击"AI 生成世界观"并选择类别（地理、历史、文化等）
- **THEN** 系统应生成符合项目类型的世界观内容
- **AND** 生成的世界观应显示预览供用户编辑

### Requirement: AI 生成情节点

系统应提供 AI 辅助情节点生成功能。

#### Scenario: 成功生成情节点
- **GIVEN** 用户在一个项目中，可能有现有的情节点
- **WHEN** 用户点击"AI 生成情节点"并提供剧情方向
- **THEN** 系统应生成符合故事逻辑的情节点建议
- **AND** 生成的情节点可以链接到章节

### Requirement: 分镜提示词生成

系统应根据剧情内容生成分镜脚本提示词，用于多媒体创作。

#### Scenario: 成功生成分镜提示词
- **GIVEN** 用户选择一个章节或情节点
- **WHEN** 用户点击"生成分镜提示词"
- **THEN** 系统应生成结构化的分镜描述（场景、人物、动作、镜头）
- **AND** 提示词可用于插画、漫画或视频制作

### Requirement: AI 一键排版

系统应提供 AI 辅助文章排版功能。

#### Scenario: 成功执行一键排版
- **GIVEN** 用户在编辑器中有文本内容
- **WHEN** 用户点击"AI 排版"按钮
- **THEN** 系统应智能格式化文本（段落、对话、场景描述）
- **AND** 对话内容应自动加粗或使用特殊格式

### Requirement: 系统设置增强

系统应提供完善的设置界面。

#### Scenario: AI 模型配置
- **GIVEN** 用户打开设置
- **WHEN** 用户配置 AI 模型（API 密钥、模型选择、参数调整）
- **THEN** 配置应正确保存并应用于后续 AI 调用

#### Scenario: 默认模型设置
- **GIVEN** 用户配置了多个 AI 模型
- **WHEN** 用户设置默认模型
- **THEN** 该模型应作为所有 AI 功能的默认选择

### Requirement: 阅读系统

系统应提供舒适的章节阅读体验。

#### Scenario: 进入阅读模式
- **GIVEN** 用户选择一个章节
- **WHEN** 用户点击"阅读模式"
- **THEN** 系统应以沉浸式界面展示章节内容
- **AND** 提供字体大小、背景色等个性化选项

---

## MODIFIED Requirements

### Requirement: 前端 API 服务

前端 API 服务需要修复参数名称问题并添加新的 AI 生成接口。

**修改内容**:
- 修复 `deleteProject` 参数名从 `id` 改为 `projectId`
- 添加 AI 生成角色、关系、世界观、情节点的接口
- 添加分镜提示词生成接口
- 添加 AI 排版接口

### Requirement: 后端 Commands

后端命令需要添加新的 AI 生成功能。

**修改内容**:
- 添加 `ai_generate_character` 命令
- 添加 `ai_generate_character_relations` 命令
- 添加 `ai_generate_worldview` 命令
- 添加 `ai_generate_plot_points` 命令
- 添加 `ai_generate_storyboard` 命令
- 添加 `ai_format_content` 命令

---

## REMOVED Requirements

无移除的需求。
